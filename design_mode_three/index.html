<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>设计模式总结三 - qingxin's blog</title><meta name=Description content="清新的博客"><meta property="og:title" content="设计模式总结三"><meta property="og:description" content="这一部分总结一下行为型设计模式中的6个，分别是：观察者模式、模板方法模式、命令模式、状态模式、职责链模式、解释器模式。 3.1 观察者模式 (Observer) 特点： 定"><meta property="og:type" content="article"><meta property="og:url" content="https://www.qingxin.org/design_mode_three/"><meta property="og:image" content="https://www.qingxin.org/logo.png"><meta property="article:published_time" content="2021-08-27T21:56:03+00:00"><meta property="article:modified_time" content="2021-08-27T21:56:03+00:00"><meta property="og:site_name" content="清新的博客"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.qingxin.org/logo.png"><meta name=twitter:title content="设计模式总结三"><meta name=twitter:description content="这一部分总结一下行为型设计模式中的6个，分别是：观察者模式、模板方法模式、命令模式、状态模式、职责链模式、解释器模式。 3.1 观察者模式 (Observer) 特点： 定"><meta name=application-name content="qingxin's blog"><meta name=apple-mobile-web-app-title content="qingxin's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.qingxin.org/design_mode_three/><link rel=prev href=https://www.qingxin.org/hexo_to_action/><link rel=next href=https://www.qingxin.org/hexo_design_mode_four/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"设计模式总结三","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.qingxin.org\/design_mode_three\/"},"genre":"posts","keywords":"基础知识, 学习笔记","wordcount":3493,"url":"https:\/\/www.qingxin.org\/design_mode_three\/","datePublished":"2021-08-27T21:56:03+00:00","dateModified":"2021-08-27T21:56:03+00:00","publisher":{"@type":"Organization","name":"qingxin"},"author":{"@type":"Person","name":"qingxin"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="qingxin's blog">野生纯逗</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/about>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="qingxin's blog">野生纯逗</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/>文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/about>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">设计模式总结三</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>qingxin</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2021-08-27>2021-08-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;3493 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;7 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/design_pattern_0.jpg data-srcset="/images/design_pattern_0.jpg, /images/design_pattern_0.jpg 1.5x, /images/design_pattern_0.jpg 2x" data-sizes=auto alt=/images/design_pattern_0.jpg title=/images/design_pattern_0.jpg></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#31-观察者模式-observer>3.1 观察者模式 (Observer)</a></li><li><a href=#32-模板方法模式-template-method>3.2 模板方法模式 (Template method)</a></li><li><a href=#33-命令模式-command>3.3 命令模式 (Command)</a></li><li><a href=#34-状态模式-state>3.4 状态模式 (State)</a></li><li><a href=#35-职责链模式-chain-of-responsibility>3.5 职责链模式 (Chain of responsibility)</a></li><li><a href=#36-解释器模式-interpreter>3.6 解释器模式 (Interpreter)</a></li></ul></nav></div></div><div class=content id=content><p>这一部分总结一下行为型设计模式中的6个，分别是：观察者模式、模板方法模式、命令模式、状态模式、职责链模式、解释器模式。</p><h2 id=31-观察者模式-observer>3.1 观察者模式 (Observer)</h2><p><strong>特点</strong>：</p><p>定义对象间的一种一对多的依赖关系，当一个对象的状态发生变更时，所有依赖于它的对象都得到通知并被自动更新</p><p><strong>应用场景</strong>：</p><ul><li><p>a.当一个抽象模型由两个部分，其中一个部分依赖于另一个部分，而两者又是封装在独立的对象中时</p></li><li><p>b.当一个对象的改变需要同时改变其他对象时，但又不知道具体有多少对象需要改变时</p></li><li><p>c.当一个对象必须通知其他对象，而又不能假定其他对象是谁的时候</p></li></ul><p><strong>UML图</strong>：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/design_pattern3_1.png data-srcset="/images/design_pattern3_1.png, /images/design_pattern3_1.png 1.5x, /images/design_pattern3_1.png 2x" data-sizes=auto alt=/images/design_pattern3_1.png title=/images/design_pattern3_1.png></p><p><strong>实现</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C++ data-lang=C++><span class=c1>// 观察者模式
</span><span class=c1></span><span class=k>class</span> <span class=nc>Observer</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>Update</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>class</span> <span class=nc>Subject</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>Attach</span><span class=p>(</span><span class=n>Observer</span> <span class=o>*</span><span class=n>observer</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>obs_list_</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>observer</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Detach</span><span class=p>(</span><span class=n>Observer</span> <span class=o>*</span><span class=n>observer</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=k>auto</span> <span class=n>it</span> <span class=o>=</span> <span class=n>obs_list_</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span> <span class=n>it</span> <span class=o>!=</span> <span class=n>obs_list_</span><span class=p>.</span><span class=n>end</span><span class=p>();)</span>
        <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=o>*</span><span class=n>it</span> <span class=o>==</span> <span class=n>observer</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>it</span> <span class=o>=</span> <span class=n>obs_list_</span><span class=p>.</span><span class=n>erase</span><span class=p>(</span><span class=n>it</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=k>else</span>
            <span class=p>{</span>
                <span class=n>it</span><span class=o>++</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Notify</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=k>auto</span> <span class=n>it</span> <span class=o>=</span> <span class=n>obs_list_</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span> <span class=n>it</span> <span class=o>!=</span> <span class=n>obs_list_</span><span class=p>.</span><span class=n>end</span><span class=p>();</span> <span class=n>it</span><span class=o>++</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=p>(</span><span class=o>*</span><span class=n>it</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>Update</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=k>private</span><span class=o>:</span>
    <span class=n>vector</span><span class=o>&lt;</span><span class=n>Observer</span> <span class=o>*&gt;</span> <span class=n>obs_list_</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>class</span> <span class=nc>ConcreteSubject</span><span class=o>:</span><span class=k>public</span> <span class=n>Subject</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>ConcreteSubject</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
    <span class=n>string</span> <span class=nf>GetState</span><span class=p>()</span> <span class=k>const</span> 
    <span class=p>{</span>
        <span class=k>return</span> <span class=n>state_</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>void</span> <span class=nf>SetState</span><span class=p>(</span><span class=n>string</span> <span class=n>state</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>state_</span> <span class=o>=</span> <span class=n>state</span><span class=p>;</span>
    <span class=p>}</span>
<span class=k>private</span><span class=o>:</span>
    <span class=n>string</span> <span class=n>state_</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>class</span> <span class=nc>ConcreteObserver</span><span class=o>:</span><span class=k>public</span> <span class=n>Observer</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>ConcreteObserver</span><span class=p>(</span><span class=n>ConcreteSubject</span> <span class=o>*</span><span class=n>subject</span><span class=p>,</span> <span class=n>string</span> <span class=n>name</span><span class=p>)</span>
        <span class=o>:</span><span class=n>subject_</span><span class=p>(</span><span class=n>subject</span><span class=p>),</span> <span class=n>name_</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
    <span class=p>{</span>
    <span class=p>}</span>
    <span class=kt>void</span> <span class=nf>Update</span><span class=p>()</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=n>state_</span> <span class=o>=</span> <span class=n>subject_</span><span class=o>-&gt;</span><span class=n>GetState</span><span class=p>();</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;observer: &#34;</span><span class=o>&lt;&lt;</span> <span class=n>name_</span><span class=p>.</span><span class=n>c_str</span><span class=p>()</span> <span class=o>&lt;&lt;</span><span class=s>&#34; state is: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>state_</span><span class=p>.</span><span class=n>c_str</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>ConcreteSubject</span><span class=o>*</span> <span class=nf>GetSubject</span><span class=p>()</span> <span class=k>const</span> 
    <span class=p>{</span>
        <span class=k>return</span> <span class=n>subject_</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>void</span> <span class=nf>SetSubject</span><span class=p>(</span><span class=n>ConcreteSubject</span> <span class=o>*</span><span class=n>subject</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>subject_</span> <span class=o>=</span> <span class=n>subject</span><span class=p>;</span>
    <span class=p>}</span>
<span class=k>private</span><span class=o>:</span>
    <span class=n>string</span> <span class=n>name_</span><span class=p>;</span>
    <span class=n>string</span> <span class=n>state_</span><span class=p>;</span>
    <span class=n>ConcreteSubject</span> <span class=o>*</span><span class=n>subject_</span><span class=p>;</span>
<span class=p>};</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>ConcreteSubject</span> <span class=o>*</span><span class=n>s</span> <span class=o>=</span> <span class=k>new</span>  <span class=n>ConcreteSubject</span><span class=p>();</span>
    <span class=n>ConcreteObserver</span> <span class=o>*</span><span class=n>x</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteObserver</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=s>&#34;X&#34;</span><span class=p>);</span>
    <span class=n>ConcreteObserver</span> <span class=o>*</span><span class=n>y</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteObserver</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=s>&#34;Y&#34;</span><span class=p>);</span>
    <span class=n>ConcreteObserver</span> <span class=o>*</span><span class=n>z</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteObserver</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=s>&#34;Z&#34;</span><span class=p>);</span>
    <span class=n>s</span><span class=o>-&gt;</span><span class=n>Attach</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
    <span class=n>s</span><span class=o>-&gt;</span><span class=n>Attach</span><span class=p>(</span><span class=n>y</span><span class=p>);</span>
    <span class=n>s</span><span class=o>-&gt;</span><span class=n>Attach</span><span class=p>(</span><span class=n>z</span><span class=p>);</span>
    <span class=n>s</span><span class=o>-&gt;</span><span class=n>SetState</span><span class=p>(</span><span class=s>&#34;ABC&#34;</span><span class=p>);</span>
    <span class=n>s</span><span class=o>-&gt;</span><span class=n>Notify</span><span class=p>();</span>

    <span class=k>delete</span> <span class=n>s</span><span class=p>;</span>
    <span class=k>delete</span> <span class=n>x</span><span class=p>;</span>
    <span class=k>delete</span> <span class=n>y</span><span class=p>;</span>
    <span class=k>delete</span> <span class=n>z</span><span class=p>;</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
<span class=cm>/**
</span><span class=cm> *  output:
</span><span class=cm>observer: X state is: ABC
</span><span class=cm>observer: Y state is: ABC
</span><span class=cm>observer: Z state is: ABC
</span><span class=cm> */</span>
</code></pre></td></tr></table></div></div><p><strong>优点</strong>：</p><ul><li>a.目标和观察者间的抽象耦合。一个目标仅知道它有一系列观察者，但是目标知道任何一个观察者属于哪一类</li><li>b.支持“广播”式通信</li></ul><p><strong>缺点</strong>：</p><ul><li>a.意外的更新。观察者间互相之间无感知，但可能会对同一资源有依赖，目标发生更新时可能会造成错误的更新</li></ul><h2 id=32-模板方法模式-template-method>3.2 模板方法模式 (Template method)</h2><p><strong>特点</strong>：</p><p>通过把不变行为搬移到超类，去除子类中的重复代码来体现优势</p><p><strong>应用场景</strong>：</p><ul><li><p>a.一次性实现算法的不变部分，并将可变的行为留给子类来实现</p></li><li><p>b.各子类的公共行为提取出来并集中到一个公共的父类中以避免代码重复</p></li><li><p>c.当需要控制子类扩展时</p></li></ul><p><strong>UML图</strong>：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/design_pattern3_2.png data-srcset="/images/design_pattern3_2.png, /images/design_pattern3_2.png 1.5x, /images/design_pattern3_2.png 2x" data-sizes=auto alt=/images/design_pattern3_2.png title=/images/design_pattern3_2.png></p><p><strong>实现</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C++ data-lang=C++><span class=c1>// 模板方法模式
</span><span class=c1></span><span class=k>class</span> <span class=nc>AbstractClass</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>PrimitiveOpr1</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>PrimitiveOpr2</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kt>void</span> <span class=nf>TemplateMethod</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>PrimitiveOpr1</span><span class=p>();</span>
        <span class=n>PrimitiveOpr2</span><span class=p>();</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; end &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>};</span>

<span class=k>class</span> <span class=nc>ConcreteClassA</span><span class=o>:</span> <span class=k>public</span> <span class=n>AbstractClass</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=kt>void</span> <span class=n>PrimitiveOpr1</span><span class=p>()</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;concrete class A opr 1&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>void</span> <span class=nf>PrimitiveOpr2</span><span class=p>()</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;concrete class A opr 2&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>};</span>

<span class=k>class</span> <span class=nc>ConcreteClassB</span><span class=o>:</span> <span class=k>public</span> <span class=n>AbstractClass</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=kt>void</span> <span class=n>PrimitiveOpr1</span><span class=p>()</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;concrete class B opr 1&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>void</span> <span class=nf>PrimitiveOpr2</span><span class=p>()</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;concrete class B opr 2&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=p>}</span>

<span class=p>};</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>AbstractClass</span> <span class=o>*</span><span class=n>c</span><span class=p>;</span>
    <span class=n>c</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteClassA</span><span class=p>();</span>
    <span class=n>c</span><span class=o>-&gt;</span><span class=n>TemplateMethod</span><span class=p>();</span>
    <span class=k>delete</span> <span class=n>c</span><span class=p>;</span>
    <span class=n>c</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteClassB</span><span class=p>();</span>
    <span class=n>c</span><span class=o>-&gt;</span><span class=n>TemplateMethod</span><span class=p>();</span>
    <span class=k>delete</span> <span class=n>c</span><span class=p>;</span>
<span class=p>}</span>
<span class=cm>/** 
</span><span class=cm> *  ouput:  
</span><span class=cm>concrete class A opr 1
</span><span class=cm>concrete class A opr 2
</span><span class=cm> end
</span><span class=cm>concrete class B opr 1
</span><span class=cm>concrete class B opr 2
</span><span class=cm> end
</span><span class=cm>*/</span>
</code></pre></td></tr></table></div></div><p><strong>优点</strong>：</p><ul><li>a.使子类摆脱重复的不变行为的纠缠</li></ul><p><strong>缺点</strong>：</p><ul><li>a.无</li></ul><h2 id=33-命令模式-command>3.3 命令模式 (Command)</h2><p><strong>特点</strong>：</p><p>将一个请求封装成一个对象，从而可用不同的请求对客户进行参数化；对请求排队或者记录请求日志，以及支持可撤销的操作</p><p><strong>应用场景</strong>：</p><ul><li><p>a.抽象出待执行的动作以参数化某对象</p></li><li><p>b.在不同的时刻指定、排列和执行请求</p></li><li><p>c.支持取消操作</p></li><li><p>d.支持修改日志</p></li><li><p>e.使用一系列不可分割的操作作为集合构建一个系统时。比如数据库中的事务系统</p></li></ul><p><strong>UML图</strong>：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/design_pattern3_3.png data-srcset="/images/design_pattern3_3.png, /images/design_pattern3_3.png 1.5x, /images/design_pattern3_3.png 2x" data-sizes=auto alt=/images/design_pattern3_3.png title=/images/design_pattern3_3.png></p><p><strong>实现</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C++ data-lang=C++><span class=c1>// 命令模式
</span><span class=c1></span><span class=k>class</span> <span class=nc>Receiver</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=kt>void</span> <span class=n>Action</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;action&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=p>}</span>    
<span class=p>};</span>

<span class=k>class</span> <span class=nc>Command</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>Command</span><span class=p>(</span><span class=n>Receiver</span> <span class=o>*</span><span class=n>receiver</span><span class=p>)</span>
        <span class=o>:</span><span class=n>receiver_</span><span class=p>(</span><span class=n>receiver</span><span class=p>)</span>
    <span class=p>{</span>
    <span class=p>}</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Execute</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
<span class=k>protected</span><span class=o>:</span>
    <span class=n>Receiver</span> <span class=o>*</span><span class=n>receiver_</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>class</span> <span class=nc>ConcreteCommand</span><span class=o>:</span> <span class=k>public</span> <span class=n>Command</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>ConcreteCommand</span><span class=p>(</span><span class=n>Receiver</span> <span class=o>*</span><span class=n>receiver</span><span class=p>)</span>
        <span class=o>:</span><span class=n>Command</span><span class=p>(</span><span class=n>receiver</span><span class=p>)</span>
    <span class=p>{}</span>
    <span class=kt>void</span> <span class=nf>Execute</span><span class=p>()</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=n>receiver_</span><span class=o>-&gt;</span><span class=n>Action</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>};</span>

<span class=k>class</span> <span class=nc>Invoker</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=kt>void</span> <span class=n>SetCommand</span><span class=p>(</span><span class=n>Command</span> <span class=o>*</span><span class=n>command</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>command_</span> <span class=o>=</span> <span class=n>command</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>void</span> <span class=nf>ExecuteCommand</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>command_</span><span class=o>-&gt;</span><span class=n>Execute</span><span class=p>();</span>
    <span class=p>}</span>
<span class=k>private</span><span class=o>:</span>
    <span class=n>Command</span> <span class=o>*</span><span class=n>command_</span><span class=p>;</span>
<span class=p>};</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>Receiver</span> <span class=o>*</span><span class=n>r</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Receiver</span><span class=p>();</span>
    <span class=n>Command</span> <span class=o>*</span><span class=n>c</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteCommand</span><span class=p>(</span><span class=n>r</span><span class=p>);</span>
    <span class=n>Invoker</span> <span class=o>*</span><span class=n>i</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Invoker</span><span class=p>();</span>
    <span class=n>i</span><span class=o>-&gt;</span><span class=n>SetCommand</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
    <span class=n>i</span><span class=o>-&gt;</span><span class=n>ExecuteCommand</span><span class=p>();</span>
    <span class=k>delete</span> <span class=n>i</span><span class=p>;</span>
    <span class=k>delete</span> <span class=n>c</span><span class=p>;</span>
    <span class=k>delete</span> <span class=n>r</span><span class=p>;</span>
<span class=p>}</span>
<span class=cm>/**
</span><span class=cm> *  output:
</span><span class=cm> *  action
</span><span class=cm> * 
</span><span class=cm> */</span>
</code></pre></td></tr></table></div></div><p><strong>优点</strong>：</p><ul><li>a.将对象的调用者和对象的构建者进行解耦</li><li>b.将命令操作进行对象化，这样就可以和其他对象一样被操控和扩展</li><li>c.可将多个命令进行组合</li><li>d.增加新的命令很容易，因为无需改变已有的类</li></ul><p><strong>缺点</strong>：</p><ul><li>a.无</li></ul><h2 id=34-状态模式-state>3.4 状态模式 (State)</h2><p><strong>特点</strong>：</p><p>主要解决的是当控制一个对象状态转换的条件表达式过于复杂时的情况。把状态的判断逻辑转移到表示不同状态的一系列类当中，可以把负责的判断逻辑简化</p><p><strong>应用场景</strong>：</p><ul><li><p>a.一个对象的行为取决于它的状态，并且它必须运行时刻根据状态改变它的行为</p></li><li><p>b.一个操作中含有庞大的多分支的条件语句，且这些分支依赖于该对象的状态</p></li></ul><p><strong>UML图</strong>：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/design_pattern3_4.png data-srcset="/images/design_pattern3_4.png, /images/design_pattern3_4.png 1.5x, /images/design_pattern3_4.png 2x" data-sizes=auto alt=/images/design_pattern3_4.png title=/images/design_pattern3_4.png></p><p><strong>实现</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C++ data-lang=C++><span class=c1>// 状态模式
</span><span class=c1></span><span class=k>class</span> <span class=nc>Context</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>State</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>Handle</span><span class=p>(</span><span class=n>Context</span> <span class=o>*</span><span class=n>context</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=k>virtual</span> <span class=n>string</span> <span class=nf>Name</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>};</span>
<span class=k>class</span> <span class=nc>Context</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>Context</span><span class=p>(</span><span class=n>State</span> <span class=o>*</span><span class=n>state</span><span class=p>)</span>
        <span class=o>:</span><span class=n>state_</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
    <span class=p>{}</span>
    <span class=kt>void</span> <span class=nf>SetState</span><span class=p>(</span><span class=n>State</span> <span class=o>*</span><span class=n>state</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>state_</span> <span class=o>=</span> <span class=n>state</span><span class=p>;</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;current state: &#34;</span><span class=o>&lt;&lt;</span> <span class=n>state_</span><span class=o>-&gt;</span><span class=n>Name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>State</span><span class=o>*</span> <span class=nf>GetState</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=n>state_</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>void</span> <span class=nf>Request</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>state_</span><span class=o>-&gt;</span><span class=n>Handle</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
    <span class=p>}</span>
<span class=k>private</span><span class=o>:</span>
    <span class=n>State</span> <span class=o>*</span><span class=n>state_</span><span class=p>;</span>
<span class=p>};</span>
<span class=k>class</span> <span class=nc>ConcreteStateB</span><span class=o>:</span> <span class=k>public</span> <span class=n>State</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=kt>void</span> <span class=n>Handle</span><span class=p>(</span><span class=n>Context</span> <span class=o>*</span><span class=n>context</span><span class=p>)</span> <span class=k>override</span><span class=p>;</span>
    <span class=n>string</span> <span class=nf>Name</span><span class=p>()</span> <span class=k>override</span><span class=p>;</span>
<span class=p>};</span>
<span class=k>class</span> <span class=nc>ConcreteStateA</span><span class=o>:</span> <span class=k>public</span> <span class=n>State</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=kt>void</span> <span class=n>Handle</span><span class=p>(</span><span class=n>Context</span> <span class=o>*</span><span class=n>context</span><span class=p>)</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>context</span><span class=o>-&gt;</span><span class=n>GetState</span><span class=p>()</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=k>delete</span> <span class=n>context</span><span class=o>-&gt;</span><span class=n>GetState</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=n>context</span><span class=o>-&gt;</span><span class=n>SetState</span><span class=p>(</span><span class=k>new</span> <span class=n>ConcreteStateB</span><span class=p>());</span>
    <span class=p>}</span>
    <span class=n>string</span> <span class=nf>Name</span><span class=p>()</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=s>&#34;StateA&#34;</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>};</span>

<span class=kt>void</span> <span class=n>ConcreteStateB</span><span class=o>::</span><span class=n>Handle</span><span class=p>(</span><span class=n>Context</span> <span class=o>*</span><span class=n>context</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>context</span><span class=o>-&gt;</span><span class=n>GetState</span><span class=p>()</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>delete</span> <span class=n>context</span><span class=o>-&gt;</span><span class=n>GetState</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=n>context</span><span class=o>-&gt;</span><span class=n>SetState</span><span class=p>(</span><span class=k>new</span> <span class=n>ConcreteStateA</span><span class=p>());</span>
<span class=p>}</span>
<span class=n>string</span> <span class=n>ConcreteStateB</span><span class=o>::</span><span class=n>Name</span><span class=p>()</span>
<span class=p>{</span>
    <span class=k>return</span> <span class=s>&#34;StateB&#34;</span><span class=p>;</span>
<span class=p>}</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>ConcreteStateA</span> <span class=o>*</span><span class=n>s</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteStateA</span><span class=p>();</span>
    <span class=n>Context</span> <span class=o>*</span><span class=n>c</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Context</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
    <span class=n>c</span><span class=o>-&gt;</span><span class=n>Request</span><span class=p>();</span>
    <span class=n>c</span><span class=o>-&gt;</span><span class=n>Request</span><span class=p>();</span>
    <span class=n>c</span><span class=o>-&gt;</span><span class=n>Request</span><span class=p>();</span>
    <span class=n>c</span><span class=o>-&gt;</span><span class=n>Request</span><span class=p>();</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>c</span><span class=o>-&gt;</span><span class=n>GetState</span><span class=p>()</span> <span class=o>!=</span> <span class=k>nullptr</span> <span class=p>)</span>
    <span class=p>{</span>
        <span class=k>delete</span> <span class=n>c</span><span class=o>-&gt;</span><span class=n>GetState</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=k>delete</span> <span class=n>c</span><span class=p>;</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
<span class=cm>/*
</span><span class=cm>* output:
</span><span class=cm>current state: StateB
</span><span class=cm>current state: StateA
</span><span class=cm>current state: StateB
</span><span class=cm>current state: StateA
</span><span class=cm>*/</span>
</code></pre></td></tr></table></div></div><p><strong>优点</strong>：</p><ul><li>a.将与特定状态相关的行为局部化，并且将不同状态的行为分割开来</li><li>b.使得状态转换显式化</li><li>c.State对象可被共享</li></ul><p><strong>缺点</strong>：</p><ul><li>a.无</li></ul><h2 id=35-职责链模式-chain-of-responsibility>3.5 职责链模式 (Chain of responsibility)</h2><p><strong>特点</strong>：</p><p>多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。接收者和发送者都没有对方明确的消息，且链中的对象自己也并不知道链的结构，结果是职责链可简化对象的相互连接，他们仅需要保持一个指向其后继者的引用，而不需要保持它所有的候选接收者的引用</p><p><strong>应用场景</strong>：</p><ul><li><p>a.有多个对象可以处理一个请求，具体哪个对象处理该请求在运行时刻自动确定</p></li><li><p>b.想在不明确接收者的情况下，向多个对象中的一个提交一个请求时</p></li><li><p>c.可处理一个请求的对象集合需要动态指定时</p></li></ul><p><strong>UML图</strong>：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/design_pattern3_5.png data-srcset="/images/design_pattern3_5.png, /images/design_pattern3_5.png 1.5x, /images/design_pattern3_5.png 2x" data-sizes=auto alt=/images/design_pattern3_5.png title=/images/design_pattern3_5.png></p><p><strong>实现</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C++ data-lang=C++><span class=c1>// 职责链模式
</span><span class=c1></span><span class=k>class</span> <span class=nc>Handler</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=kt>void</span> <span class=n>SetSuccessor</span><span class=p>(</span><span class=n>Handler</span> <span class=o>*</span><span class=n>successor</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>successor_</span> <span class=o>=</span> <span class=n>successor</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=kt>int</span> <span class=n>request</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
<span class=k>protected</span><span class=o>:</span>
    <span class=n>Handler</span> <span class=o>*</span><span class=n>successor_</span><span class=p>;</span>
    <span class=n>string</span> <span class=n>name_</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>class</span> <span class=nc>ConcreteHandlerA</span><span class=o>:</span> <span class=k>public</span> <span class=n>Handler</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>ConcreteHandlerA</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>name_</span> <span class=o>=</span> <span class=s>&#34;HandlerA&#34;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=kt>int</span> <span class=n>request</span><span class=p>)</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>request</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>request</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span>  <span class=n>name_</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; handler &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>request</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> 
        <span class=p>}</span>
        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>successor_</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>successor_</span><span class=o>-&gt;</span><span class=n>HandleRequest</span><span class=p>(</span><span class=n>request</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>};</span>
<span class=k>class</span> <span class=nc>ConcreteHandlerB</span><span class=o>:</span> <span class=k>public</span> <span class=n>Handler</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>ConcreteHandlerB</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>name_</span> <span class=o>=</span> <span class=s>&#34;HandlerB&#34;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=kt>int</span> <span class=n>request</span><span class=p>)</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>request</span> <span class=o>&gt;=</span> <span class=mi>10</span> <span class=o>&amp;&amp;</span> <span class=n>request</span> <span class=o>&lt;</span> <span class=mi>20</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>name_</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; handler &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>request</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>successor_</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>successor_</span><span class=o>-&gt;</span><span class=n>HandleRequest</span><span class=p>(</span><span class=n>request</span><span class=p>);</span>
        <span class=p>}</span>   
    <span class=p>}</span>
<span class=p>};</span>

<span class=k>class</span> <span class=nc>ConcreteHandlerC</span><span class=o>:</span> <span class=k>public</span> <span class=n>Handler</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>ConcreteHandlerC</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>name_</span> <span class=o>=</span> <span class=s>&#34;HandlerC&#34;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=kt>int</span> <span class=n>request</span><span class=p>)</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>request</span> <span class=o>&gt;=</span> <span class=mi>20</span> <span class=o>&amp;&amp;</span> <span class=n>request</span> <span class=o>&lt;</span> <span class=mi>30</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>name_</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; handler &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>request</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>successor_</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>successor_</span><span class=o>-&gt;</span><span class=n>HandleRequest</span><span class=p>(</span><span class=n>request</span><span class=p>);</span>
        <span class=p>}</span>
        
    <span class=p>}</span>
<span class=p>};</span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>Handler</span> <span class=o>*</span><span class=n>h1</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteHandlerA</span><span class=p>();</span>
    <span class=n>Handler</span> <span class=o>*</span><span class=n>h2</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteHandlerB</span><span class=p>();</span>
    <span class=n>Handler</span> <span class=o>*</span><span class=n>h3</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConcreteHandlerC</span><span class=p>();</span>
    <span class=n>h1</span><span class=o>-&gt;</span><span class=n>SetSuccessor</span><span class=p>(</span><span class=n>h2</span><span class=p>);</span>
    <span class=n>h2</span><span class=o>-&gt;</span><span class=n>SetSuccessor</span><span class=p>(</span><span class=n>h3</span><span class=p>);</span>
    <span class=kt>int</span> <span class=n>requests</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>18</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span><span class=mi>20</span><span class=p>};</span>
    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>requests</span><span class=p>)</span><span class=o>/</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>h1</span><span class=o>-&gt;</span><span class=n>HandleRequest</span><span class=p>(</span><span class=n>requests</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
    <span class=p>}</span>
    <span class=k>delete</span> <span class=n>h3</span><span class=p>;</span>
    <span class=k>delete</span> <span class=n>h2</span><span class=p>;</span>
    <span class=k>delete</span> <span class=n>h1</span><span class=p>;</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
<span class=cm>/*
</span><span class=cm>output:
</span><span class=cm>HandlerA handler 2
</span><span class=cm>HandlerA handler 5
</span><span class=cm>HandlerB handler 14
</span><span class=cm>HandlerC handler 22
</span><span class=cm>HandlerB handler 18
</span><span class=cm>HandlerA handler 3
</span><span class=cm>HandlerC handler 27
</span><span class=cm>HandlerC handler 20
</span><span class=cm>*/</span>
</code></pre></td></tr></table></div></div><p><strong>优点</strong>：</p><ul><li>a.降低耦合度</li><li>b.增强了给对象指派职责的灵活性</li></ul><p><strong>缺点</strong>：</p><ul><li>a.不保证接受。可能存在没有任何一个对象处理该请求</li></ul><h2 id=36-解释器模式-interpreter>3.6 解释器模式 (Interpreter)</h2><p><strong>特点</strong>：</p><p>如果一个特定类型的问题发生的频率足够高，那么可能就值得将问题的各个实例表述为一个简单语言中的句子。这样就可以构建一个解释器，该解释器通过解释这些句子的问题来解决该问题。</p><p><strong>应用场景</strong>：</p><ul><li><p>a.对于复杂的文法，抽象出来的文法比较简单时</p></li><li><p>b.效率不是一个关键问题时</p></li></ul><p><strong>UML图</strong>：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/design_pattern3_6.png data-srcset="/images/design_pattern3_6.png, /images/design_pattern3_6.png 1.5x, /images/design_pattern3_6.png 2x" data-sizes=auto alt=/images/design_pattern3_6.png title=/images/design_pattern3_6.png></p><p><strong>实现</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C++ data-lang=C++><span class=c1>// 解释器模式
</span><span class=c1></span><span class=k>class</span> <span class=nc>PlayContext</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>string</span> <span class=n>GetPlayText</span><span class=p>()</span> <span class=k>const</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=n>text_</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>void</span> <span class=nf>SetPlayText</span><span class=p>(</span><span class=n>string</span> <span class=n>text</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>text_</span> <span class=o>=</span> <span class=n>text</span><span class=p>;</span>
    <span class=p>}</span>
<span class=k>private</span><span class=o>:</span>
    <span class=n>string</span> <span class=n>text_</span><span class=p>;</span>
<span class=p>};</span>
<span class=k>class</span> <span class=nc>Expression</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=kt>void</span> <span class=n>Interpret</span><span class=p>(</span><span class=n>PlayContext</span> <span class=o>*</span> <span class=n>context</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>context</span><span class=o>-&gt;</span><span class=n>GetPlayText</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=k>return</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>else</span>
        <span class=p>{</span>
            <span class=n>string</span> <span class=n>play_text</span> <span class=o>=</span> <span class=n>context</span><span class=o>-&gt;</span><span class=n>GetPlayText</span><span class=p>();</span>
            <span class=kt>char</span> <span class=n>key</span> <span class=o>=</span> <span class=n>play_text</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
            <span class=kt>int</span> <span class=n>pos1</span> <span class=o>=</span> <span class=n>find_notspace</span><span class=p>(</span><span class=n>play_text</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
            <span class=kt>int</span> <span class=n>pos2</span> <span class=o>=</span> <span class=n>play_text</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=sc>&#39; &#39;</span><span class=p>,</span> <span class=n>pos1</span><span class=p>);</span>
            <span class=n>string</span> <span class=n>str</span> <span class=o>=</span> <span class=n>play_text</span><span class=p>.</span><span class=n>substr</span><span class=p>(</span><span class=n>pos1</span><span class=p>,</span> <span class=n>pos2</span><span class=o>-</span><span class=n>pos1</span><span class=p>);</span>
            <span class=kt>double</span> <span class=n>value</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>stod</span><span class=p>(</span><span class=n>str</span><span class=p>);</span>
            <span class=kt>int</span> <span class=n>next</span> <span class=o>=</span> <span class=n>find_notspace</span><span class=p>(</span><span class=n>play_text</span><span class=p>,</span><span class=n>pos2</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>next</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>context</span><span class=o>-&gt;</span><span class=n>SetPlayText</span><span class=p>(</span><span class=n>play_text</span><span class=p>.</span><span class=n>substr</span><span class=p>(</span><span class=n>next</span><span class=p>,</span> <span class=n>play_text</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>-</span> <span class=n>next</span><span class=p>));</span>
            <span class=p>}</span>
            <span class=k>else</span>
            <span class=p>{</span>
                <span class=n>context</span><span class=o>-&gt;</span><span class=n>SetPlayText</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
            <span class=p>}</span>
            
            <span class=n>Execute</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=k>private</span><span class=o>:</span>
    <span class=kt>int</span> <span class=n>find_notspace</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span> <span class=o>&amp;</span><span class=n>str</span><span class=p>,</span> <span class=kt>int</span> <span class=n>start</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>start</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>str</span><span class=p>.</span><span class=n>size</span><span class=p>();</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>isspace</span><span class=p>(</span><span class=n>str</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>
            <span class=p>{</span>
                <span class=k>return</span> <span class=n>i</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Execute</span><span class=p>(</span><span class=kt>char</span> <span class=n>key</span><span class=p>,</span> <span class=kt>double</span> <span class=n>vlaue</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>};</span>
<span class=k>class</span> <span class=nc>Note</span><span class=o>:</span> <span class=k>public</span> <span class=n>Expression</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=kt>void</span> <span class=n>Execute</span><span class=p>(</span><span class=kt>char</span> <span class=n>key</span><span class=p>,</span> <span class=kt>double</span> <span class=n>value</span><span class=p>)</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=n>string</span> <span class=n>note</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
        <span class=k>switch</span> <span class=p>(</span><span class=n>key</span><span class=p>)</span>
        <span class=p>{</span>
        <span class=k>case</span> <span class=sc>&#39;C&#39;</span><span class=o>:</span>
            <span class=n>note</span> <span class=o>=</span> <span class=s>&#34;1 &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=sc>&#39;D&#39;</span><span class=o>:</span>
            <span class=n>note</span> <span class=o>=</span> <span class=s>&#34;2 &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=sc>&#39;E&#39;</span><span class=o>:</span>
            <span class=n>note</span> <span class=o>=</span> <span class=s>&#34;3 &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=sc>&#39;F&#39;</span><span class=o>:</span>
            <span class=n>note</span> <span class=o>=</span> <span class=s>&#34;4 &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=sc>&#39;G&#39;</span><span class=o>:</span>
            <span class=n>note</span> <span class=o>=</span> <span class=s>&#34;5 &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=sc>&#39;A&#39;</span><span class=o>:</span>
            <span class=n>note</span> <span class=o>=</span> <span class=s>&#34;6 &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=sc>&#39;B&#39;</span><span class=o>:</span>
            <span class=n>note</span> <span class=o>=</span> <span class=s>&#34;7 &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>        
        <span class=k>default</span><span class=o>:</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>note</span> <span class=p>;</span>
    <span class=p>}</span>
    
<span class=p>};</span>
<span class=k>class</span> <span class=nc>Scale</span><span class=o>:</span> <span class=k>public</span> <span class=n>Expression</span>
<span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>Execute</span><span class=p>(</span><span class=kt>char</span> <span class=n>key</span><span class=p>,</span> <span class=kt>double</span> <span class=n>value</span><span class=p>)</span> <span class=k>override</span>
    <span class=p>{</span>
        <span class=n>string</span> <span class=n>scale</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
        <span class=kt>int</span> <span class=n>tmp</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>value</span><span class=p>;</span>
        <span class=k>switch</span> <span class=p>(</span><span class=n>tmp</span><span class=p>)</span>
        <span class=p>{</span>
        <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
            <span class=n>scale</span> <span class=o>=</span> <span class=s>&#34; low &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
            <span class=n>scale</span> <span class=o>=</span> <span class=s>&#34; mid &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=mi>3</span><span class=o>:</span>
            <span class=n>scale</span> <span class=o>=</span> <span class=s>&#34; high &#34;</span><span class=p>;</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>default</span><span class=o>:</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>scale</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>};</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>PlayContext</span> <span class=o>*</span><span class=n>context</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PlayContext</span><span class=p>();</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;song: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=n>context</span><span class=o>-&gt;</span><span class=n>SetPlayText</span><span class=p>(</span><span class=s>&#34;O 2 E 0.5 G 0.5 A 3 E 0.5 G 0.5 D 3 E 0.5 G 0.5 A 0.5 O 3 C 1 O 2 A 0.5 G 1 C 0.5 E 0.5 D 3&#34;</span><span class=p>);</span>
    <span class=n>Expression</span> <span class=o>*</span><span class=n>expression</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
    <span class=k>while</span> <span class=p>(</span><span class=n>context</span><span class=o>-&gt;</span><span class=n>GetPlayText</span><span class=p>().</span><span class=n>size</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=kt>char</span> <span class=n>c</span> <span class=o>=</span> <span class=n>context</span><span class=o>-&gt;</span><span class=n>GetPlayText</span><span class=p>().</span><span class=n>at</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
        <span class=k>switch</span> <span class=p>(</span><span class=n>c</span><span class=p>)</span>
        <span class=p>{</span>
        <span class=k>case</span> <span class=sc>&#39;O&#39;</span><span class=o>:</span>
            <span class=n>expression</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Scale</span><span class=p>();</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=sc>&#39;C&#39;</span><span class=o>:</span>
        <span class=k>case</span> <span class=sc>&#39;D&#39;</span><span class=o>:</span>
        <span class=k>case</span> <span class=sc>&#39;E&#39;</span><span class=o>:</span>
        <span class=k>case</span> <span class=sc>&#39;F&#39;</span><span class=o>:</span>
        <span class=k>case</span> <span class=sc>&#39;G&#39;</span><span class=o>:</span>
        <span class=k>case</span> <span class=sc>&#39;A&#39;</span><span class=o>:</span>
        <span class=k>case</span> <span class=sc>&#39;B&#39;</span><span class=o>:</span>
        <span class=k>case</span> <span class=sc>&#39;P&#39;</span><span class=o>:</span>
            <span class=n>expression</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Note</span><span class=p>();</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>default</span><span class=o>:</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=n>expression</span><span class=o>-&gt;</span><span class=n>Interpret</span><span class=p>(</span><span class=n>context</span><span class=p>);</span>
        <span class=k>delete</span> <span class=n>expression</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>      
    <span class=k>delete</span> <span class=n>context</span><span class=p>;</span>
<span class=p>}</span>

<span class=cm>/*
</span><span class=cm>output:
</span><span class=cm>song: 
</span><span class=cm> mid 3 5 6 3 5 2 3 5 6  high 1  mid 6 5 1 3 2
</span><span class=cm>*/</span>
</code></pre></td></tr></table></div></div><p><strong>优点</strong>：</p><ul><li>a.易于改变和扩展文法。因为该模式使用类来表示文法规则，你可以使用继承来改变和扩展该文法</li><li>b.易于实现文法。因为定义抽象语法树中各节点的类的实现大体类似</li></ul><p><strong>缺点</strong>：</p><ul><li>a.包含许多规则的文法难以管理和维护。文法中的每一条规则至少定义了一个类，当文法复杂时，各类就错综复杂了</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-08-27</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/>基础知识</a>,&nbsp;<a href=/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>学习笔记</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/hexo_to_action/ class=prev rel=prev title="将hexo博客由本地迁移到GitHub Actions"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>将hexo博客由本地迁移到GitHub Actions</a>
<a href=/hexo_design_mode_four/ class=next rel=next title=设计模式总结四>设计模式总结四<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":30},"comment":{},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>